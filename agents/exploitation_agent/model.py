from core.config import settings
from exploitation_agent.nodes.prompts import qa_prompt
from langchain_gigachat import GigaChat
from langchain_neo4j import GraphCypherQAChain, Neo4jGraph

gigachat_model = GigaChat(
    credentials=settings.GIGA_KEY,
    model="GigaChat",
    timeout=30,
    ca_bundle_file="russian_trusted_root_ca.cer",
    # verify_ssl_certs=False,
    # temperature=0,
)


graph = Neo4jGraph(
    url=settings.NEO4J_URL,
    username=settings.NEO4J_USERNAME,
    password=settings.NEO4J_PASSWORD,
    enhanced_schema=True,
)


exploitation_agent = GraphCypherQAChain.from_llm(
    gigachat_model,
    graph=graph,
    verbose=True,
    allow_dangerous_requests=True,
    top_k=3,
    # return_direct=True,
    qa_prompt=qa_prompt,
    exclude_types=["table_embedding"],
)
