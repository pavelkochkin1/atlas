# Atlas Agents

## Описание сервиса

**Atlas Agents** — это сервис, состоящий из двух специализированных агентов: **Exploration Agent** и **Exploitation Agent**. Сервис построен на основе FastAPI и предназначен для автоматизации процессов исследования и эксплуатации данных в корпоративных системах. Агенты взаимодействуют с базой данных Neo4j, системой управления версиями GitLab, платформой Confluence и другими внутренними сервисами для обеспечения эффективного управления данными и генерации полезной информации.

## Структура агентов

### 1. Exploration Agent

**Exploration Agent** ответственный за сбор, обработку и структурирование информации о таблицах базы данных. Его основные задачи включают:

- **Сбор схемы базы данных**: Получение списка всех таблиц из схемы базы данных.
- **Извлечение информации из GitLab и Confluence**: Сбор описаний и кода таблиц из систем управления версиями и корпоративной вики.
- **Объединение данных**: Объединение информации из различных источников в единый JSON-формат.
- **Управление черновиками**: Создание и обновление черновиков с описанием таблиц в центральной системе.

**Инструменты и компоненты Exploration Agent:**

- **Prompts**:
  - `research_prompt`: Шаблон запроса для сбора информации о таблице.
  - `unify_prompt`: Шаблон для объединения данных из разных источников.
  - `relation_prompt`: Шаблон для определения связей между таблицами.
  - `teams_refiner`: Шаблон для уточнения информации о командах.

- **Nodes**:
  - `agent_researcher`: Агент для исследования данных.
  - `agent_unifier`: Агент для объединения данных.
  - `relation_finder`: Агент для поиска связей между таблицами.
  - `team_refiner`: Агент для уточнения информации о командах.

- **Tools**:
  - `drafts.py`: Работа с черновиками таблиц.
  - `neo4j.py`: Взаимодействие с базой данных Neo4j.
  - `sources.py`: Получение информации из GitLab, Confluence и других источников.
  - `utils.py`: Утилиты для обработки данных.

### 2. Exploitation Agent

**Exploitation Agent** предназначен для обработки пользовательских запросов и генерации ответов на основе существующей информации в базе данных. Основные задачи:

- **Обработка вопросов**: Приём и интерпретация вопросов от пользователей.
- **Генерация ответов**: Использование модели GigaChat для формирования ответов на основе данных из Neo4j.

**Инструменты и компоненты Exploitation Agent:**

- **Prompts**:
  - `qa_prompt`: Шаблон для генерации ответов на вопросы.

- **Nodes**:
  - `exploitation_agent`: Основной агент для взаимодействия с пользователями.

- **Tools**:
  - Интеграция с Neo4j и GigaChat для обработки запросов и генерации ответов.

## Настройка и запуск

### 1. Клонирование репозитория

```bash
git clone https://github.com/your-repo/atlas-agents.git
cd atlas-agents/agents
```

### 2. Создание файла окружения

Скопируйте пример файла `.env.example` в файл `.env` и заполните необходимые переменные окружения:

```bash
cp .env.example .env
```

Заполните в `.env` следующие переменные:

- `GIGA_KEY`: Ваш API ключ для GigaChat.
- `NEO4J_URL`: URL подключения к базе данных Neo4j.
- `NEO4J_USERNAME`: Имя пользователя для доступа к Neo4j.
- `NEO4J_PASSWORD`: Пароль для доступа к Neo4j.

### 3. Сборка Docker-образа

Убедитесь, что [Docker](https://www.docker.com/) установлен на вашем компьютере.

```bash
docker build -t atlas-agents .
```

### 4. Запуск контейнера

```bash
docker run -d -p 8053:8053 --env-file .env atlas-agents
```

Контейнер будет запущен и доступен по адресу `http://localhost:8053`.

### 5. Использование API

- **Создание черновиков**: Отправьте POST-запрос на эндпоинт `/create_drafts` для запуска процесса создания черновиков.

  ```bash
  curl -X POST http://localhost:8053/create_drafts
  ```

- **Получение ответа на вопрос**: Отправьте GET-запрос на эндпоинт `/` с параметром `question`.

  ```bash
  curl "http://localhost:8053/?question=Ваш вопрос здесь"
  ```

## Инструменты агентов

### Exploration Agent

- **langchain-core**: Возможности для создания цепочек обработки данных.
- **langchain-gigachat**: Интеграция с моделью GigaChat для обработки естественного языка.
- **langchain-neo4j**: Интеграция с базой данных Neo4j для работы с графовыми данными.

### Exploitation Agent

- **langchain-neo4j**: Используется для извлечения данных из Neo4j на основе пользовательских запросов.
- **langchain-gigachat**: Генерация ответов на основе данных из Neo4j.

## Структура проекта

```
atlas/
└── agents/
    ├── .env.example
    ├── Dockerfile
    ├── README.md
    ├── core/
    │   └── config.py
    ├── exploitation_agent/
    │   ├── model.py
    │   └── nodes/
    │       └── prompts.py
    ├── exploration_agent/
    │   ├── draft_creation.py
    │   ├── model.py
    │   ├── nodes/
    │   │   ├── info_refiner.py
    │   │   ├── relation_finder.py
    │   │   ├── researcher.py
    │   │   └── unifier.py
    │   ├── tools/
    │   │   ├── drafts.py
    │   │   ├── neo4j.py
    │   │   ├── sources.py
    │   │   └── utils.py
    ├── main.py
    └── requirements.txt
```
